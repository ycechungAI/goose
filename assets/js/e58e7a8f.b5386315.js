"use strict";(self.webpackChunkgoose=self.webpackChunkgoose||[]).push([[4554],{81642:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>g,frontMatter:()=>o,metadata:()=>i,toc:()=>l});var i=t(36347),a=t(74848),s=t(28453);const o={title:"Democratizing Detection Engineering at Block: Taking Flight with Goose and Panther MCP",description:"A comprehensive overview of how Block leverages Goose and Panther MCP to democratize and accelerate security detection engineering.",authors:["tomasz","glenn"]},r=void 0,c={authorsImageUrls:[void 0,void 0]},l=[{value:"The Detection Engineering Challenge",id:"the-detection-engineering-challenge",level:2},{value:"Vision",id:"vision",level:2},{value:"Introducing Panther MCP",id:"introducing-panther-mcp",level:2},{value:"What is Panther MCP?",id:"what-is-panther-mcp",level:3},{value:"Key Features",id:"key-features",level:3},{value:"Accelerating Detection Creation with Goose",id:"accelerating-detection-creation-with-goose",level:2},{value:"Integrating Panther MCP as a Goose Extension",id:"integrating-panther-mcp-as-a-goose-extension",level:3},{value:"Leveraging Enhanced Context with <code>.goosehints</code>",id:"leveraging-enhanced-context-with-goosehints",level:3},{value:"Breaking Down the Barriers",id:"breaking-down-the-barriers",level:2},{value:"The Intelligence Behind the Simplicity",id:"the-intelligence-behind-the-simplicity",level:2},{value:"Democratization in Practice",id:"democratization-in-practice",level:2},{value:"Early Impact &amp; Lessons Learned",id:"early-impact--lessons-learned",level:2},{value:"Expanding Collaboration to Enhance Coverage and Enable Self-Service",id:"expanding-collaboration-to-enhance-coverage-and-enable-self-service",level:3},{value:"Accelerating the Detection Development Lifecycle",id:"accelerating-the-detection-development-lifecycle",level:3},{value:"Driving Consistency via Standardized Practices",id:"driving-consistency-via-standardized-practices",level:3},{value:"Best Practices and Safeguards",id:"best-practices-and-safeguards",level:3},{value:"What\u2019s Next?",id:"whats-next",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",br:"br",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components},{Head:i}=n;return i||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Head",!0),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"blog cover",src:t(85928).A+"",width:"1534",height:"879"})}),"\n",(0,a.jsx)(n.p,{children:"Detection engineering stands at the forefront of cybersecurity, yet it\u2019s often a tangled web of complexity. Traditional detection writing involves painstaking manual processes encompassing log format and schema comprehension, intricate query creation, threat modeling, and iterative manual detection testing and refinement, leading to time expenditure and reliance on specialized expertise. This can lead to gaps in threat coverage and an overwhelming number of alerts. At Block, we face the relentless challenge of evolving threats and intricate system complexities. To stay ahead, we've embraced AI-driven solutions, notably Goose, Block\u2019s open-source AI agent, and Panther MCP, to allow the broader organization to contribute high-quality rules that are contextual to their area of expertise. This post delves into how we're transforming complicated detection workflows into streamlined, AI-powered, accessible processes for all stakeholders."}),"\n",(0,a.jsx)(n.h2,{id:"the-detection-engineering-challenge",children:"The Detection Engineering Challenge"}),"\n",(0,a.jsx)(n.p,{children:"Historically, creating effective detections has been a niche skill, requiring deep technical knowledge and coding proficiency. This has created significant obstacles such as:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Steep Learning Curve:"})," Crafting detections typically requires extensive technical expertise, often limiting participation."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Resources Constraints:"})," Even expert security teams often struggle with bandwidth, hindering their ability to develop and deploy new detections quickly."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Evolving Threat Landscape:"})," Advanced threats, particularly those from sophisticated nation-states actors, continuously evolve, outpacing traditional detection development processes."]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"vision",children:"Vision"}),"\n",(0,a.jsx)(n.p,{children:"We envision a future where anyone at Block can effortlessly create and deploy security detections, revolutionizing our defenses through intelligent automation and empowering a democratized security posture."}),"\n",(0,a.jsx)(n.h2,{id:"introducing-panther-mcp",children:"Introducing Panther MCP"}),"\n",(0,a.jsx)(n.h3,{id:"what-is-panther-mcp",children:"What is Panther MCP?"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"https://github.com/panther-labs/mcp-panther",children:"Panther MCP"})," is an open-source model context protocol server born from the collaboration between ",(0,a.jsx)(n.a,{href:"https://panther.com/",children:"Panther"})," and Block to democratize security operations workflows. By tightly integrating with Goose as an extension, Panther MCP allows security teams at Block to translate natural language instructions into precise, executable SIEM detection logic, making threat detection contributions easier and faster than ever."]}),"\n",(0,a.jsx)(n.p,{children:"This integration empowers analysts and engineers across Block to interact with Panther\u2019s security analytics platform seamlessly. It shifts detection development from a coding-heavy process into an intuitive workflow accessible to everyone, regardless of technical background. Goose serves as an intermediary agent, coordinating calls to Panther MCP, reviewing the output, creating rule content, testing it, and making necessary edits for correctness or style. This AI-driven feedback loop saves countless hours of time."}),"\n",(0,a.jsx)(n.h3,{id:"key-features",children:"Key Features"}),"\n",(0,a.jsx)(n.p,{children:"Panther MCP offers dozens of tools that enhance and accelerate detection engineering workflows powered by Goose:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Natural Language to Detection Logic"}),(0,a.jsx)(n.br,{}),"\n","Engineers define detections using plain English prompts, which Panther MCP translates directly into Panther-compatible detection rules that can be checked into their ",(0,a.jsx)(n.a,{href:"https://github.com/panther-labs/panther-analysis",children:"panther-analysis"})," repository."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Interactive Data Exploration and Usage"}),(0,a.jsx)(n.br,{}),"\n","Engineers can rapidly explore log sources and perform searches on data and previously generated alerts through quick, natural-language driven interactions."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Unified Alert Triage and Response"}),(0,a.jsx)(n.br,{}),"\n","Enables AI-led alert triage with insights drawn from historical data and existing detections."]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"accelerating-detection-creation-with-goose",children:"Accelerating Detection Creation with Goose"}),"\n",(0,a.jsx)(n.p,{children:"Goose significantly accelerates security detection creation by using AI to automate traditionally manual tasks like log analysis and rule generation. This drastically reduces effort, improves the speed of developing and deploying threat coverage, and enhances agility against evolving threats."}),"\n",(0,a.jsx)(n.h3,{id:"integrating-panther-mcp-as-a-goose-extension",children:"Integrating Panther MCP as a Goose Extension"}),"\n",(0,a.jsx)(n.p,{children:"Panther MCP functions as a Goose extension, seamlessly embedding its capabilities within the Goose environment through the following process:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Extension Registration:"})," Panther MCP is registered within Goose, making its suite of tools readily accessible via the Goose interface."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"API Connectivity:"})," The extension establishes a connection to Panther's backend API, enabling seamless context retrieval."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Available Tools:"})," Panther MCP provides Goose with a range of tools designed for efficient detection creation, intuitive data interaction, and streamlined alert management."]}),"\n"]}),"\n",(0,a.jsxs)(n.h3,{id:"leveraging-enhanced-context-with-goosehints",children:["Leveraging Enhanced Context with ",(0,a.jsx)(n.code,{children:".goosehints"})]}),"\n",(0,a.jsxs)(n.p,{children:["The integration between Panther MCP and Goose is enhanced through the use of the ",(0,a.jsx)(n.a,{href:"https://block.github.io/goose/docs/guides/using-goosehints/",children:".goosehints"})," file\u2014a Goose feature that supplies additional context like rule examples and best practices. This enriched context enables Goose to generate more accurate and efficient detections, aligned with Block\u2019s standards and requirements."]}),"\n",(0,a.jsx)(n.p,{children:"Let's illustrate this with an example: creating a rule to detect users adding themselves to privileged Okta groups, a common privilege escalation technique."}),"\n",(0,a.jsx)(n.h2,{id:"breaking-down-the-barriers",children:"Breaking Down the Barriers"}),"\n",(0,a.jsx)(n.p,{children:"Traditionally, creating this detection would require:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Deep knowledge of Okta and its log structure"}),"\n",(0,a.jsx)(n.li,{children:"Understanding of Panther\u2019s detection framework"}),"\n",(0,a.jsx)(n.li,{children:"Python programming skills"}),"\n",(0,a.jsx)(n.li,{children:"Familiarity with different testing frameworks"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"With Goose and Panther MCP, this becomes as simple as:"}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"\u201cWrite a detection rule for users adding themselves to privileged Okta groups.\u201d"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"the-intelligence-behind-the-simplicity",children:"The Intelligence Behind the Simplicity"}),"\n",(0,a.jsx)(n.p,{children:'When a natural language request like "Write a detection rule for users adding themselves to privileged Okta groups" is received, Goose leverages a sophisticated, multi-stage process powered by Panther MCP to generate production-ready detection logic. This automated approach mirrors the workflow of an experienced detection engineer, encompassing threat research, relevant log identification, detection goal definition, logic outlining, sample log analysis, rule development, false positive consideration, severity/context assignment, thorough testing, refinement/optimization, and documentation. However, Goose executes these steps with the speed and scalability afforded by AI and automation.'}),"\n",(0,a.jsxs)(n.p,{children:['Goose first parses the natural language input to understand the core intent and requirements. It identifies key entities like "users", "privileged Okta groups", and the action "adding themselves". This understanding forms the basis for outlining the detection\'s objective, the necessary log source (',(0,a.jsx)(n.code,{children:"Okta.SystemLog"}),"), and the fundamental logic: identifying events where the actor (user initiating the action) is the same as the target user (the user being added to the group), and the group being joined is designated as privileged. Goose also considers potential false positives (e.g., legitimate automated processes) and assigns a preliminary severity level based on the potential impact of the detected activity (privilege escalation)."]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Process overview diagram",src:t(35133).A+"",width:"1443",height:"289"})}),"\n",(0,a.jsxs)(n.p,{children:["To ensure the generated logic is accurate and operates on valid data, Goose interacts with Panther MCP to retrieve the schema of the specified log source (",(0,a.jsx)(n.code,{children:"Okta.SystemLog"}),"). This provides Goose with a structured understanding of the available fields and their data types within Okta logs. Furthermore, Goose utilizes Panther MCP's querying capabilities to fetch sample log events related to group membership changes. This step is crucial for:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Identifying Common Event Patterns:"})," Analyzing real-world logs allows Goose to understand the typical structure and values associated with relevant events (e.g., ",(0,a.jsx)(n.code,{children:"group.user_membership.add"}),")."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Inferring Privileged Group Naming Conventions:"}),' By examining historical data, Goose can identify patterns and keywords commonly used in the naming of privileged groups within the organization\'s Okta instance (e.g., "admin", "administrator", "security-admin").']}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Discovering Edge Cases:"})," Examining diverse log samples helps uncover potential variations in event data or less common scenarios that the detection logic needs to accommodate."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Mapping Typical User Behavior:"})," Understanding baseline user behavior around group membership changes helps refine the detection logic and reduce the likelihood of false positives."]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"The interaction with Panther MCP at this stage involves API calls to retrieve schema information and execute analytical queries, enabling Goose to ground its reasoning in actual log data."}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Goose interacts with Panther MCP",src:t(42180).A+"",width:"1448",height:"426"})}),"\n",(0,a.jsxs)(n.p,{children:["Goose doesn't operate in isolation; it accesses a repository of existing Panther detection rules to identify similar logic or reusable components. This promotes consistency across the detection landscape, encourages the reuse of well-tested helper functions (like ",(0,a.jsx)(n.code,{children:"okta_alert_context"}),"), and ensures adherence to established rule standards within our security ecosystem. Learning from existing detections is a core component of Goose\u2019s intelligence, allowing it to build upon prior knowledge and avoid reinventing the wheel."]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Rule context reuse",src:t(70957).A+"",width:"1451",height:"184"})}),"\n",(0,a.jsx)(n.p,{children:"Based on the understanding of the detection goal, the analysis of log data, and the knowledge gleaned from existing detections facilitated by Panther MCP, Goose generates the complete Panther detection rule in Python. This includes:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsxs)(n.strong,{children:["Rule Function (",(0,a.jsx)(n.code,{children:"rule()"}),"):"]})," This function contains the core logic for evaluating each log event. In the example, it checks for the ",(0,a.jsx)(n.code,{children:"group.user_membership.add"})," event type, verifies that the actor and target user IDs (or emails) are the same, and confirms that the target group's display name contains keywords indicative of a privileged group (defined in the ",(0,a.jsx)(n.code,{children:"PRIVILEGED_GROUPS"})," set)."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsxs)(n.strong,{children:["Metadata Functions (",(0,a.jsx)(n.code,{children:"title()"}),", ",(0,a.jsx)(n.code,{children:"alert_context()"}),", ",(0,a.jsx)(n.code,{children:"severity()"}),", ",(0,a.jsx)(n.code,{children:"destinations()"}),"):"]})," These functions provide crucial context and operational information for triggered alerts."]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'from panther_okta_helpers import okta_alert_context\n\n# Define privileged Okta groups - customize this list based on your organization\'s needs\nPRIVILEGED_GROUPS = {\n    "_group_admin",  # Administrator roles\n    "admin",\n    "administrator",\n    "application-admin",   \n    "aws_",  # AWS roles can be privileged\n    "cicd_corp_system",  # CI/CD admin access \n    "grc-okta",\n    "okta-administrators",\n    "okta_admin",\n    "okta_admin_svc_accounts", # Admin roles\n    "okta_resource-set_",      # Resource sets are typically privileged\n    "security-admin",\n    "superadministrators",\n}\n\ndef rule(event):\n    """Determine if a user added themselves to a privileged group"""\n    # Only focus on group membership addition events\n    if event.get("eventType") != "group.user_membership.add":\n        return False\n    # Ensure both actor and target exist in the event\n    actor = event.get("actor", {})\n    targets = event.get("target", [])\n    if not actor or len(targets) < 2:\n        return False\n    actor_id = actor.get("alternateId", "").lower()\n    actor_user_id = actor.get("id")\n    # Extract target user and group\n    target_user = targets[0]\n    target_group = targets[1] if len(targets) > 1 else {}\n    # The first target should be a user and the second should be a group\n    if target_user.get("type") != "User" or target_group.get("type") != "UserGroup":\n        return False\n    target_user_id = target_user.get("id")\n    target_user_email = target_user.get("alternateId", "").lower()\n    group_name = target_group.get("displayName", "").lower()\n    # Check if the actor added themselves to the group\n    is_self_add = (actor_user_id == target_user_id) or (actor_id == target_user_email)\n    # Check if the group is privileged\n    is_privileged_group = any(priv_group in group_name for priv_group in PRIVILEGED_GROUPS)\n    return is_self_add and is_privileged_group\n\ndef title(event):\n    """Generate a descriptive title for the alert"""\n    actor = event.get("actor", {})\n    targets = event.get("target", [])\n    actor_name = actor.get("displayName", "Unknown User")\n    actor_email = actor.get("alternateId", "unknown@example.com")\n    target_group = targets[1] if len(targets) > 1 else {}\n    group_name = target_group.get("displayName", "Unknown Group")\n    return (f"User [{actor_name} ({actor_email})] added themselves "\n            f"to privileged Okta group [{group_name}]")\n\ndef alert_context(event):\n    """Return additional context for the alert"""\n    context = okta_alert_context(event)\n    # Add specific information about the privileged group\n    targets = event.get("target", [])\n    if len(targets) > 1:\n        target_group = targets[1]\n        context["privileged_group"] = {\n            "id": target_group.get("id", ""),\n            "name": target_group.get("displayName", ""),\n        }\n    return context\n\ndef severity(event):\n    """Calculate severity based on group name - more sensitive groups get higher severity"""\n    targets = event.get("target", [])\n    if len(targets) <= 1:\n        return "Medium"\n    target_group = targets[1]\n    group_name = target_group.get("displayName", "").lower()\n    # Higher severity for direct admin groups\n    if any(name in group_name for name in ["admin", "administrator", "superadministrators"]):\n        return "Critical"\n    return "High"\n\ndef destinations(_event):\n    """Send to staging destination for review"""\n    return ["staging_destination"]\n'})}),"\n",(0,a.jsx)(n.p,{children:"Beyond the Python code, Goose also generates the corresponding YAML-based rule configuration file. This file contains essential metadata about the detection:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'AnalysisType: rule\nDescription: Detects when a user adds themselves to a privileged Okta group, which could indicate privilege escalation attempts or unauthorized access.\nDisplayName: "Users Adding Themselves to Privileged Okta Groups"\nEnabled: true\nDedupPeriodMinutes: 60\nLogTypes:\n  - Okta.SystemLog\nRuleID: "goose.Okta.Self.Privileged.Group.Add"\nThreshold: 1\nFilename: goose_okta_self_privileged_group_add.py\nReference: >\n  https://developer.okta.com/docs/reference/api/system-log/\n  https://attack.mitre.org/techniques/T1078/004/\n  https://attack.mitre.org/techniques/T1484/001/\nRunbook: >\n  1. Verify if the user should have access to the privileged group they added themselves to\n  2. If unauthorized, revoke the group membership immediately\n  3. Check for other group membership changes made by the same user\n  4. Review the authentication context and security context for suspicious indicators\n  5. Interview the user to determine intent\nReports:\n  MITRE ATT&CK:\n    - TA0004:T1078.004  # Privileged Accounts: Cloud Accounts\n    - TA0004:T1484.001  # Domain Policy Modification: Group Policy Modification\nSeverity: High\nTags:\n  - author:tomasz\n  - coauthor:goose\nTests:\n  - Name: User adds themselves to privileged group\n    ExpectedResult: true\n    Log:\n      actor:\n        alternateId: jane.doe@company.com\n        displayName: Jane Doe\n        id: 00u1234abcd5678\n        type: User\n      authenticationContext:\n        authenticationStep: 0\n        externalSessionId: xyz1234\n      client:\n        device: Computer\n        geographicalContext:\n          city: San Francisco\n          country: United States\n          geolocation:\n            lat: 37.7749\n            lon: -122.4194\n          postalCode: "94105"\n          state: California\n        ipAddress: 192.168.1.100\n        userAgent:\n          browser: CHROME\n          os: Mac OS X\n          rawUserAgent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36\n        zone: "null"\n      debugContext:\n        debugData:\n          requestId: req123456\n          requestUri: /api/v1/groups/00g123456/users/00u1234abcd5678\n          url: /api/v1/groups/00g123456/users/00u1234abcd5678\n      displayMessage: Add user to group membership\n      eventType: group.user_membership.add\n      legacyEventType: group.user_membership.add\n      outcome:\n        result: SUCCESS\n      published: "2023-07-15 14:25:30.811"\n      request:\n        ipChain:\n          - geographicalContext:\n              city: San Francisco\n              country: United States\n              geolocation:\n                lat: 37.7749\n                lon: -122.4194\n              postalCode: "94105"\n              state: California\n            ip: 192.168.1.100\n            version: V4\n      securityContext:\n        asNumber: 12345\n        asOrg: Example ISP\n        domain: example.com\n        isProxy: false\n        isp: Example ISP\n      severity: INFO\n      target:\n        - alternateId: jane.doe@company.com\n          displayName: Jane Doe\n          id: 00u1234abcd5678\n          type: User\n        - alternateId: unknown\n          displayName: okta_admin_person_role_super_admin\n          id: 00g5678abcd1234\n          type: UserGroup\n      transaction:\n        detail: {}\n        id: transaction123\n        type: WEB\n      uuid: event-uuid-123\n      version: "0"\n      p_event_time: "2023-07-15 14:25:30.811"\n      p_parse_time: "2023-07-15 14:26:00.000"\n      p_log_type: "Okta.SystemLog"\n  - Name: User adds another user to privileged group\n    ExpectedResult: false\n    Log:\n      actor:\n        alternateId: admin@company.com\n        displayName: Admin User\n        id: 00u5678abcd1234\n        type: User\n      authenticationContext:\n        authenticationStep: 0\n        externalSessionId: xyz5678\n      client:\n        device: Computer\n        geographicalContext:\n          city: San Francisco\n          country: United States\n          geolocation:\n            lat: 37.7749\n            lon: -122.4194\n          postalCode: "94105"\n          state: California\n        ipAddress: 192.168.1.100\n        userAgent:\n          browser: CHROME\n          os: Mac OS X\n          rawUserAgent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36\n        zone: "null"\n      debugContext:\n        debugData:\n          requestId: req789012\n          requestUri: /api/v1/groups/00g123456/users/00u9876fedc4321\n          url: /api/v1/groups/00g123456/users/00u9876fedc4321\n      displayMessage: Add user to group membership\n      eventType: group.user_membership.add\n      legacyEventType: group.user_membership.add\n      outcome:\n        result: SUCCESS\n      published: "2023-07-15 14:30:45.123"\n      request:\n        ipChain:\n          - geographicalContext:\n              city: San Francisco\n              country: United States\n              geolocation:\n                lat: 37.7749\n                lon: -122.4194\n              postalCode: "94105"\n              state: California\n            ip: 192.168.1.100\n            version: V4\n      securityContext:\n        asNumber: 12345\n        asOrg: Example ISP\n        domain: example.com\n        isProxy: false\n        isp: Example ISP\n      severity: INFO\n      target:\n        - alternateId: user@company.com\n          displayName: Regular User\n          id: 00u9876fedc4321\n          type: User\n        - alternateId: unknown\n          displayName: okta_admin_person_role_super_admin\n          id: 00g5678abcd1234\n          type: UserGroup\n      transaction:\n        detail: {}\n        id: transaction456\n        type: WEB\n      uuid: event-uuid-456\n      version: "0"\n      p_event_time: "2023-07-15 14:30:45.123"\n      p_parse_time: "2023-07-15 14:31:00.000"\n      p_log_type: "Okta.SystemLog"\n'})}),"\n",(0,a.jsx)(n.p,{children:"Every detection rule generated by Goose undergoes rigorous automated testing and validation. This includes:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Unit Testing:"})," Using the test cases defined in the rule configuration, the Panther Analysis Tool is executed to verify that the rule logic correctly identifies true positives and avoids false negatives against simulated log data."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Linting:"})," Code linting tools (like Pylint) are automatically run to ensure the generated Python code adheres to established coding standards, including proper formatting, style conventions, and best practices. This contributes to code maintainability and reduces the risk of errors."]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.img,{alt:"Automated testing graphic",src:t(10004).A+"",width:"1158",height:"1316"}),"\n",(0,a.jsx)(n.img,{alt:"Process improvement chart",src:t(7745).A+"",width:"1155",height:"262"})]}),"\n",(0,a.jsx)(n.p,{children:"The seamless integration of Goose with Panther MCP automates these intricate steps, significantly reducing the time and specialized knowledge required to create and deploy security detections. This democratization empowers more individuals to contribute to Block's security posture, leading to more comprehensive threat coverage and a more resilient security environment."}),"\n",(0,a.jsx)(n.h2,{id:"democratization-in-practice",children:"Democratization in Practice"}),"\n",(0,a.jsx)(n.p,{children:"A typical detection creation workflow now looks like:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Proposal:"})," A user describes a malicious behavior in natural language."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Generation:"})," Goose transforms this description into detection logic with Panther MCP."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Review:"})," The detection team reviews each detection against defined quality benchmarks."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Deployment:"})," Approved detections are deployed to staging/production."]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"early-impact--lessons-learned",children:"Early Impact & Lessons Learned"}),"\n",(0,a.jsx)(n.h3,{id:"expanding-collaboration-to-enhance-coverage-and-enable-self-service",children:"Expanding Collaboration to Enhance Coverage and Enable Self-Service"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Lowering the Technical Barrier:"})," Goose and Panther MCP empower subject matter experts (SMEs) to easily understand their logs in Panther, enabling a self-service model where teams can create their own detections without extensive security engineering expertise, thus distributing the workload."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Reduced Dependency on the Detection Team:"})," Panther MCP reduces security team dependency by enabling users to independently resolve inquiries autonomously. This includes threat intelligence teams assessing MITRE ATT&CK coverage, compliance teams identifying relevant detections, and helping service SMEs create their own detections."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Cross-Functional Detection Development:"})," Democratizing detection engineering allows specialized teams to create detections that security teams might miss, leading to a more diverse detection ecosystem covering niche use cases. This fosters two-way knowledge transfer, enhancing overall security awareness and capabilities."]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"accelerating-the-detection-development-lifecycle",children:"Accelerating the Detection Development Lifecycle"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Contextual Understanding:"})," Detection engineering is becoming more efficient and consistent through tools that embed organizational context, provide guided best practices, understand existing log schemas and detections, and align with validation frameworks such as ",(0,a.jsx)(n.em,{children:"pytest"}),". This approach enables broader participation and supports high-quality development across teams."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Streamlined Development Process:"})," Natural language interfaces are simplifying detection engineering by allowing users to interact with the system conversationally. This enables automated retrieval of example logs, analysis of log schemas, interpretation of detection goals or required changes, and generation of initial detection code\u2014significantly accelerating development."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Automated Technical Steps:"})," Intelligent code generation incorporates error handling and best practices, while seamlessly generating test cases from data and producing comprehensive documentation\u2014including descriptions, runbooks, and references."]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"driving-consistency-via-standardized-practices",children:"Driving Consistency via Standardized Practices"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Code Style and Structure:"})," Newly created detections adhere to consistent stylistic patterns, utilizing dedicated functions for specific checks instead of overloaded ",(0,a.jsx)(n.code,{children:"rule()"})," checks. Standardized formatting, including brackets for dynamic alert title text, enhances readability and consistency."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Code Reuse and Efficiency:"})," Promote code reuse and efficiency through global helpers/filters, explicit typing in function signatures, and detailed docstrings for better function understanding and LLM code generation."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Maintainability Improvements:"})," Detections are designed with a consistent structure and standardized patterns, making them easier to understand, maintain, and update. This uniformity ensures predictable behavior across the detection code base and simplifies bulk changes when needed."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Comprehensive Testing Requirements:"})," For our team, each detection is required to include at least two unit tests: one positive case that triggers the detection and one negative case that does not. Test names are descriptive and aligned with expected outcomes to enhance readability and maintainability."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Metadata and Documentation Standards:"})," Metadata and documentation standards are being strengthened through structured definitions within pytests, helping to codify detection ownership and context. This includes clearly defined author and coauthor tags (e.g., for Goose-generated content), environment references such as staging or production, and accurate mapping of alert destinations."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Structural Validation:"})," This supports compliance with organizational standards by enforcing filename conventions (e.g., prefixing, length, lowercase formatting), ensuring Python rules include all required functions, and verifying that YAML files contain the necessary fields for proper functionality and processing."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Security Framework Alignment:"})," Relevant rules are mapped to applicable MITRE ATT&CK techniques to highlight coverage gaps, inform detection development, prioritize research efforts, and establish a common language for discussing threats."]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"best-practices-and-safeguards",children:"Best Practices and Safeguards"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Platform-Conformant Development:"})," Detections are developed in alignment with Panther\u2019s recommended practices, such as using built-in event object methods like ",(0,a.jsx)(n.code,{children:"event.deep_get()"})," and ",(0,a.jsx)(n.code,{children:"event.deep_walk()"})," instead of importing them manually, ensuring consistency and maintainability within the platform."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Proactive Error Prevention:"})," We implement local validation checks through pre-commit and pre-push hooks to proactively catch and resolve errors before they reach upstream builds. These checks include validating alert destination names, verifying log types, and flagging grammatical issues to ensure quality and consistency."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Continuous Improvement:"})," Detection quality continuously improves by incorporating feedback, performance data, and analysis of detection trends. Panther MCP, along with other ticket tracking MCPs, provides insights from analyst feedback and alert dispositions, which facilitates automated adjustments, streamlines pull request development, and lowers operational overhead."]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"whats-next",children:"What\u2019s Next?"}),"\n",(0,a.jsx)(n.p,{children:"Block is dedicated to improving its security defenses and supporting its team by leveraging AI. We believe AI holds significant promise for the future of detection and response at Block and are committed to making security more accessible."}),"\n",(0,a.jsxs)(i,{children:[(0,a.jsx)("meta",{property:"og:title",content:"Democratizing Detection Engineering at Block: Taking Flight with Goose and Panther MCP"}),(0,a.jsx)("meta",{property:"og:type",content:"article"}),(0,a.jsx)("meta",{property:"og:url",content:"https://block.github.io/goose/blog/2025/06/02/goose-panther-mcp"}),(0,a.jsx)("meta",{property:"og:description",content:"A comprehensive overview of how Block leverages Goose and Panther MCP to democratize and accelerate security detection engineering."}),(0,a.jsx)("meta",{property:"og:image",content:"https://block.github.io/goose/assets/images/goose-panther-header-25b5891acdd70e6a7bbe6b84e34f08f0.png"}),(0,a.jsx)("meta",{name:"twitter:card",content:"summary_large_image"}),(0,a.jsx)("meta",{property:"twitter:domain",content:"block.github.io/goose"}),(0,a.jsx)("meta",{name:"twitter:title",content:"Democratizing Detection Engineering at Block: Taking Flight with Goose and Panther MCP"}),(0,a.jsx)("meta",{name:"twitter:description",content:"A comprehensive overview of how Block leverages Goose and Panther MCP to democratize and accelerate security detection engineering."}),(0,a.jsx)("meta",{name:"twitter:image",content:"https://block.github.io/goose/assets/images/goose-panther-header-25b5891acdd70e6a7bbe6b84e34f08f0.png"})]})]})}function g(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},10004:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/automated-testing-graphic-aafa22b18427c32d851c98a1a32a5d8a.png"},70957:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/context-reuse-example-8a77763351f738734fe87068dabfba87.png"},85928:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/goose-panther-header-25b5891acdd70e6a7bbe6b84e34f08f0.png"},42180:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/goose-panther-mcp-interaction-ae32c310d436afad5c67ae632649c0c3.png"},7745:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/process-improvement-chart-eea292cb14dd3519f36cada6314ea694.png"},35133:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/process-overview-diagram-11aa53158f5a0484351b12fe602dae1b.png"},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>r});var i=t(96540);const a={},s=i.createContext(a);function o(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),i.createElement(s.Provider,{value:n},e.children)}},36347:e=>{e.exports=JSON.parse('{"permalink":"/goose/blog/2025/06/02/goose-panther-mcp","source":"@site/blog/2025-06-02-goose-panther-mcp/index.md","title":"Democratizing Detection Engineering at Block: Taking Flight with Goose and Panther MCP","description":"A comprehensive overview of how Block leverages Goose and Panther MCP to democratize and accelerate security detection engineering.","date":"2025-06-02T00:00:00.000Z","tags":[],"readingTime":16.105,"hasTruncateMarker":true,"authors":[{"name":"Tomasz Tchorz","title":"Security Engineer","page":{"permalink":"/goose/blog/authors/tomasz"},"socials":{"linkedin":"https://www.linkedin.com/in/tomasztchorz/","github":"https://github.com/tomala90"},"imageURL":"https://avatars.githubusercontent.com/u/75388736?v=4","key":"tomasz"},{"name":"Glenn Edwards","title":"Detection Engineer","page":{"permalink":"/goose/blog/authors/glenn"},"socials":{"linkedin":"https://www.linkedin.com/in/glennpedwardsjr/","github":"https://github.com/hiddenillusion","x":"https://x.com/hiddenillusion","bluesky":"https://bsky.app/profile/hiddenillusion"},"imageURL":"https://avatars.githubusercontent.com/u/1418309?v=4","key":"glenn"}],"frontMatter":{"title":"Democratizing Detection Engineering at Block: Taking Flight with Goose and Panther MCP","description":"A comprehensive overview of how Block leverages Goose and Panther MCP to democratize and accelerate security detection engineering.","authors":["tomasz","glenn"]},"unlisted":false,"prevItem":{"title":"Treating LLMs Like Tools in a Toolbox: A Multi-Model Approach to Smarter AI Agents","permalink":"/goose/blog/2025/06/16/multi-model-in-goose"},"nextItem":{"title":"3 Prompts to Test for Agent Readiness","permalink":"/goose/blog/2025/05/22/llm-agent-readiness"}}')}}]);