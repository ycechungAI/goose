/*! For license information please see 12714b95.cd5adc96.js.LICENSE.txt */
"use strict";(self.webpackChunkgoose=self.webpackChunkgoose||[]).push([[5342],{2139:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>d,default:()=>x,frontMatter:()=>c,metadata:()=>s,toc:()=>h});const s=JSON.parse('{"id":"guides/smart-context-management","title":"Smart Context Management","description":"When working with Large Language Models (LLMs), there are limits to how much conversation history they can process at once. Goose provides smart context management features to help you maintain productive sessions even when reaching these limits. Here are the key concepts:","source":"@site/docs/guides/smart-context-management.md","sourceDirName":"guides","slug":"/guides/smart-context-management","permalink":"/goose/docs/guides/smart-context-management","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":22,"frontMatter":{"title":"Smart Context Management","sidebar_position":22,"sidebar_label":"Smart Context Management"},"sidebar":"tutorialSidebar","previous":{"title":"Environment Variables","permalink":"/goose/docs/guides/environment-variables"},"next":{"title":"CLI Providers","permalink":"/goose/docs/guides/cli-providers"}}');var r=n(74848),a=n(28453),o=n(65537),i=n(79329);const l=(0,n(75395).A)("ScrollText",[["path",{d:"M15 12h-5",key:"r7krc0"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]]),c={title:"Smart Context Management",sidebar_position:22,sidebar_label:"Smart Context Management"},d=void 0,u={},h=[{value:"Smart Context Management Features",id:"smart-context-management-features",level:2},{value:"Using Smart Context Management",id:"using-smart-context-management",level:2},{value:"Default Context Strategy",id:"default-context-strategy",level:4},{value:"Token Usage",id:"token-usage",level:2},{value:"Cost Tracking",id:"cost-tracking",level:2}];function m(e){const t={a:"a",code:"code",h2:"h2",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(t.p,{children:["When working with ",(0,r.jsx)(t.a,{href:"/docs/getting-started/providers",children:"Large Language Models (LLMs)"}),", there are limits to how much conversation history they can process at once. Goose provides smart context management features to help you maintain productive sessions even when reaching these limits. Here are the key concepts:"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Context Length"}),": The amount of conversation history the LLM can consider"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Context Limit"}),": The maximum number of tokens the model can process"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Context Management"}),": How Goose handles conversations approaching these limits"]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"smart-context-management-features",children:"Smart Context Management Features"}),"\n",(0,r.jsx)(t.p,{children:"When a conversation reaches the context limit, Goose offers different ways to handle it:"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Feature"}),(0,r.jsx)(t.th,{children:"Description"}),(0,r.jsx)(t.th,{children:"Best For"}),(0,r.jsx)(t.th,{children:"Impact"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.strong,{children:"Summarization"})}),(0,r.jsx)(t.td,{children:"Condenses conversation while preserving key points"}),(0,r.jsx)(t.td,{children:"Long, complex conversations"}),(0,r.jsx)(t.td,{children:"Maintains most context"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.strong,{children:"Truncation"})}),(0,r.jsx)(t.td,{children:"Removes oldest messages to make room"}),(0,r.jsx)(t.td,{children:"Simple, linear conversations"}),(0,r.jsx)(t.td,{children:"Loses old context"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.strong,{children:"Clear"})}),(0,r.jsx)(t.td,{children:"Starts fresh while keeping session active"}),(0,r.jsx)(t.td,{children:"New direction in conversation"}),(0,r.jsx)(t.td,{children:"Loses all context"})]})]})]}),"\n",(0,r.jsx)(t.h2,{id:"using-smart-context-management",children:"Using Smart Context Management"}),"\n",(0,r.jsxs)(o.A,{groupId:"interface",children:[(0,r.jsxs)(i.A,{value:"ui",label:"Goose Desktop",default:!0,children:[(0,r.jsx)(t.p,{children:"Goose Desktop exclusively uses summarization to manage context, preserving key information while reducing size."}),(0,r.jsxs)(o.A,{children:[(0,r.jsxs)(i.A,{value:"automatic",label:"Automatic",default:!0,children:[(0,r.jsx)(t.p,{children:"When you reach the context limit in Goose Desktop:"}),(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsx)(t.li,{children:"Goose will automatically start summarizing the conversation to make room."}),"\n",(0,r.jsxs)(t.li,{children:["You'll see a message that says ",(0,r.jsx)(t.strong,{children:'"Preparing summary..."'}),", followed by ",(0,r.jsx)(t.strong,{children:'"Session summarized."'})]}),"\n",(0,r.jsxs)(t.li,{children:["Once complete, you'll have the option to ",(0,r.jsx)(t.strong,{children:'"View or edit summary."'})]}),"\n",(0,r.jsx)(t.li,{children:"You can then continue the session with the summarized context in place."}),"\n"]})]}),(0,r.jsxs)(i.A,{value:"manual",label:"Manual",children:[(0,r.jsx)(t.p,{children:"You can proactively summarize your conversation before reaching context limits:"}),(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["Click the scroll text icon (",(0,r.jsx)(l,{className:"inline",size:16}),") in the chat interface"]}),"\n",(0,r.jsx)(t.li,{children:"Confirm the summarization in the modal"}),"\n",(0,r.jsx)(t.li,{children:"View or edit the generated summary if needed"}),"\n"]})]})]})]}),(0,r.jsxs)(i.A,{value:"cli",label:"Goose CLI",children:[(0,r.jsx)(t.p,{children:"The CLI offers three context management options: summarize, truncate, or clear your session."}),(0,r.jsx)(t.h4,{id:"default-context-strategy",children:"Default Context Strategy"}),(0,r.jsxs)(t.p,{children:["You can configure Goose to automatically handle context limits without prompting by setting the ",(0,r.jsx)(t.code,{children:"GOOSE_CONTEXT_STRATEGY"})," environment variable:"]}),(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"# Set default strategy (choose one)\nexport GOOSE_CONTEXT_STRATEGY=summarize  # Automatically summarize (recommended)\nexport GOOSE_CONTEXT_STRATEGY=truncate   # Automatically remove oldest messages\nexport GOOSE_CONTEXT_STRATEGY=clear      # Automatically clear session\nexport GOOSE_CONTEXT_STRATEGY=prompt     # Always prompt user (default)\n"})}),(0,r.jsx)(t.p,{children:(0,r.jsx)(t.strong,{children:"Default behavior:"})}),(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Interactive mode"}),": Prompts user to choose (equivalent to ",(0,r.jsx)(t.code,{children:"prompt"}),")"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Headless mode"})," (",(0,r.jsx)(t.code,{children:"goose run"}),"): Automatically summarizes (equivalent to ",(0,r.jsx)(t.code,{children:"summarize"}),")"]}),"\n"]}),(0,r.jsxs)(o.A,{children:[(0,r.jsxs)(i.A,{value:"automatic",label:"Automatic",default:!0,children:[(0,r.jsx)(t.p,{children:"When you hit the context limit, the behavior depends on your configuration:"}),(0,r.jsxs)(t.p,{children:[(0,r.jsxs)(t.strong,{children:["With default settings (no ",(0,r.jsx)(t.code,{children:"GOOSE_CONTEXT_STRATEGY"})," set)"]}),", you'll see this prompt to choose a management option:"]}),(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-sh",children:"\u25c7  The model's context length is maxed out. You will need to reduce the # msgs. Do you want to?\n\u2502  \u25cb Clear Session   \n\u2502  \u25cb Truncate Message\n// highlight-start\n\u2502  \u25cf Summarize Session\n// highlight-end\n\nfinal_summary: [A summary of your conversation will appear here]\n\nContext maxed out\n--------------------------------------------------\nGoose summarized messages for you.\n"})}),(0,r.jsxs)(t.p,{children:[(0,r.jsxs)(t.strong,{children:["With ",(0,r.jsx)(t.code,{children:"GOOSE_CONTEXT_STRATEGY"})," configured"]}),", Goose will automatically apply your chosen strategy:"]}),(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-sh",children:"# Example with GOOSE_CONTEXT_STRATEGY=summarize\nContext maxed out - automatically summarized messages.\n--------------------------------------------------\nGoose automatically summarized messages for you.\n\n# Example with GOOSE_CONTEXT_STRATEGY=truncate\nContext maxed out - automatically truncated messages.\n--------------------------------------------------\nGoose tried its best to truncate messages for you.\n\n# Example with GOOSE_CONTEXT_STRATEGY=clear\nContext maxed out - automatically cleared session.\n--------------------------------------------------\n"})})]}),(0,r.jsxs)(i.A,{value:"manual",label:"Manual",children:[(0,r.jsxs)(t.p,{children:["To proactively trigger summarization before reaching context limits, use the ",(0,r.jsx)(t.code,{children:"/summarize"})," command:"]}),(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-sh",children:"( O)> /summarize\n\u25c7  Are you sure you want to summarize this conversation? This will condense the message history.\n\u2502  Yes \n\u2502\nSummarizing conversation...\nConversation has been summarized.\nKey information has been preserved while reducing context length.\n"})})]})]})]})]}),"\n",(0,r.jsx)(t.h2,{id:"token-usage",children:"Token Usage"}),"\n",(0,r.jsx)(t.p,{children:"After sending your first message, Goose Desktop and Goose CLI display token usage."}),"\n",(0,r.jsxs)(o.A,{groupId:"interface",children:[(0,r.jsxs)(i.A,{value:"ui",label:"Goose Desktop",default:!0,children:[(0,r.jsx)(t.p,{children:"The Desktop displays a colored circle next to the model name at the bottom of the session window. The color provides a visual indicator of your token usage for the session."}),(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Green"}),": Normal usage - Plenty of context space available"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Orange"}),": Warning state - Approaching limit (80% of capacity)"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Red"}),": Error state - Context limit reached"]}),"\n"]}),(0,r.jsx)(t.p,{children:"Hover over this circle to display:"}),(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"The number of tokens used"}),"\n",(0,r.jsx)(t.li,{children:"The percentage of available tokens used"}),"\n",(0,r.jsx)(t.li,{children:"The total available tokens"}),"\n",(0,r.jsx)(t.li,{children:"A progress bar showing your current token usage"}),"\n"]})]}),(0,r.jsxs)(i.A,{value:"cli",label:"Goose CLI",children:[(0,r.jsx)(t.p,{children:"The CLI displays a context label above each command prompt, showing:"}),(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["A visual indicator using dots (\u25cf\u25cb) and colors to represent your token usage:","\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Green"}),": Below 50% usage"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Yellow"}),": Between 50-85% usage"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Red"}),": Above 85% usage"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(t.li,{children:"Usage percentage"}),"\n",(0,r.jsx)(t.li,{children:"Current token count and context limit"}),"\n"]})]})]}),"\n",(0,r.jsx)(t.h2,{id:"cost-tracking",children:"Cost Tracking"}),"\n",(0,r.jsx)(t.p,{children:"Display real-time costs of your session at the bottom of the Goose Desktop window."}),"\n",(0,r.jsxs)(o.A,{groupId:"interface",children:[(0,r.jsxs)(i.A,{value:"ui",label:"Goose Desktop",default:!0,children:[(0,r.jsx)(t.p,{children:"To manage live cost tracking:"}),(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["Click ",(0,r.jsx)(t.code,{children:"\u2699\ufe0f"})," in the upper right corner"]}),"\n",(0,r.jsxs)(t.li,{children:["Click ",(0,r.jsx)(t.code,{children:"Advanced Settings"})]}),"\n",(0,r.jsxs)(t.li,{children:["Scroll to ",(0,r.jsx)(t.code,{children:"App Settings"})," and toggle ",(0,r.jsx)(t.code,{children:"Cost Tracking"})," on or off."]}),"\n"]}),(0,r.jsx)(t.p,{children:"The session cost updates dynamically as tokens are consumed. Hover over the cost to see a detailed breakdown of token usage. If multiple models are used in the session, this includes a cost breakdown by model. Ollama and local deployments always show a cost of $0.00."}),(0,r.jsxs)(t.p,{children:["Pricing data is regularly fetched from the OpenRouter API and cached locally. The ",(0,r.jsx)(t.code,{children:"Advanced Settings"})," tab shows when the data was last updated and allows you to refresh."]}),(0,r.jsx)(t.p,{children:"These costs are estimates only, and not connected to your actual provider bill. The cost shown is an approximation based on token counts and public pricing data."})]}),(0,r.jsx)(i.A,{value:"cli",label:"Goose CLI",children:(0,r.jsxs)(t.p,{children:["Cost tracking is ",(0,r.jsx)(t.a,{href:"https://github.com/block/goose/issues/3206",children:"not yet available"})," in the Goose CLI."]})})]})]})}function x(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(m,{...e})}):m(e)}},79329:(e,t,n)=>{n.d(t,{A:()=>o});n(96540);var s=n(34164);const r={tabItem:"tabItem_Ymn6"};var a=n(74848);function o(e){let{children:t,hidden:n,className:o}=e;return(0,a.jsx)("div",{role:"tabpanel",className:(0,s.A)(r.tabItem,o),hidden:n,children:t})}},65537:(e,t,n)=>{n.d(t,{A:()=>w});var s=n(96540),r=n(34164),a=n(65627),o=n(56347),i=n(50372),l=n(30604),c=n(11861),d=n(78749);function u(e){return s.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,s.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:t,children:n}=e;return(0,s.useMemo)((()=>{const e=t??function(e){return u(e).map((e=>{let{props:{value:t,label:n,attributes:s,default:r}}=e;return{value:t,label:n,attributes:s,default:r}}))}(n);return function(e){const t=(0,c.XI)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function m(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function x(e){let{queryString:t=!1,groupId:n}=e;const r=(0,o.W6)(),a=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,l.aZ)(a),(0,s.useCallback)((e=>{if(!a)return;const t=new URLSearchParams(r.location.search);t.set(a,e),r.replace({...r.location,search:t.toString()})}),[a,r])]}function g(e){const{defaultValue:t,queryString:n=!1,groupId:r}=e,a=h(e),[o,l]=(0,s.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!m({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const s=n.find((e=>e.default))??n[0];if(!s)throw new Error("Unexpected error: 0 tabValues");return s.value}({defaultValue:t,tabValues:a}))),[c,u]=x({queryString:n,groupId:r}),[g,p]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[r,a]=(0,d.Dv)(n);return[r,(0,s.useCallback)((e=>{n&&a.set(e)}),[n,a])]}({groupId:r}),j=(()=>{const e=c??g;return m({value:e,tabValues:a})?e:null})();(0,i.A)((()=>{j&&l(j)}),[j]);return{selectedValue:o,selectValue:(0,s.useCallback)((e=>{if(!m({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);l(e),u(e),p(e)}),[u,p,a]),tabValues:a}}var p=n(9136);const j={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var f=n(74848);function v(e){let{className:t,block:n,selectedValue:s,selectValue:o,tabValues:i}=e;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,a.a_)(),d=e=>{const t=e.currentTarget,n=l.indexOf(t),r=i[n].value;r!==s&&(c(t),o(r))},u=e=>{let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const n=l.indexOf(e.currentTarget)+1;t=l[n]??l[0];break}case"ArrowLeft":{const n=l.indexOf(e.currentTarget)-1;t=l[n]??l[l.length-1];break}}t?.focus()};return(0,f.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":n},t),children:i.map((e=>{let{value:t,label:n,attributes:a}=e;return(0,f.jsx)("li",{role:"tab",tabIndex:s===t?0:-1,"aria-selected":s===t,ref:e=>{l.push(e)},onKeyDown:u,onClick:d,...a,className:(0,r.A)("tabs__item",j.tabItem,a?.className,{"tabs__item--active":s===t}),children:n??t},t)}))})}function b(e){let{lazy:t,children:n,selectedValue:a}=e;const o=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=o.find((e=>e.props.value===a));return e?(0,s.cloneElement)(e,{className:(0,r.A)("margin-top--md",e.props.className)}):null}return(0,f.jsx)("div",{className:"margin-top--md",children:o.map(((e,t)=>(0,s.cloneElement)(e,{key:t,hidden:e.props.value!==a})))})}function y(e){const t=g(e);return(0,f.jsxs)("div",{className:(0,r.A)("tabs-container",j.tabList),children:[(0,f.jsx)(v,{...t,...e}),(0,f.jsx)(b,{...t,...e})]})}function w(e){const t=(0,p.A)();return(0,f.jsx)(y,{...e,children:u(e.children)},String(t))}},28453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>i});var s=n(96540);const r={},a=s.createContext(r);function o(e){const t=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(a.Provider,{value:t},e.children)}},75395:(e,t,n)=>{n.d(t,{A:()=>i});var s=n(96540);const r=(...e)=>e.filter(((e,t,n)=>Boolean(e)&&""!==e.trim()&&n.indexOf(e)===t)).join(" ").trim();var a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const o=(0,s.forwardRef)((({color:e="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:o,className:i="",children:l,iconNode:c,...d},u)=>(0,s.createElement)("svg",{ref:u,...a,width:t,height:t,stroke:e,strokeWidth:o?24*Number(n)/Number(t):n,className:r("lucide",i),...d},[...c.map((([e,t])=>(0,s.createElement)(e,t))),...Array.isArray(l)?l:[l]]))),i=(e,t)=>{const n=(0,s.forwardRef)((({className:n,...a},i)=>{return(0,s.createElement)(o,{ref:i,iconNode:t,className:r(`lucide-${l=e,l.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,n),...a});var l}));return n.displayName=`${e}`,n}}}]);